<div class="blog-container">

  <!-- KeresÅ‘ + rendezÃ©s -->
  <div class="toolbar">
    <input
      type="text"
      placeholder="KeresÃ©s posztok kÃ¶zÃ¶tt..."
      [(ngModel)]="searchTerm"
      class="search-input"
    />
    <select [(ngModel)]="sortOrder" class="sort-select">
      <option value="latest">LegÃºjabb elÃ¶l</option>
      <option value="oldest">LegrÃ©gebbi elÃ¶l</option>
      <option value="mostComments">LegtÃ¶bb komment</option>
    </select>
  </div>

  <!-- Ãšj poszt -->
  <div class="new-post-card">
    <h3 class="new-post-title">Ãšj bejegyzÃ©s</h3>
    <textarea [(ngModel)]="newPostContent" placeholder="Ãrd meg a gondolataid..."></textarea>
    <input type="file" (change)="onFileSelected($event)" accept="image/*" />
    <img *ngIf="selectedImage" [src]="selectedImage" alt="KÃ©p elÅ‘nÃ©zet" style="max-width: 100%; margin-top: 1rem;">
    <button (click)="addPost()">KÃ¶zzÃ©tÃ©tel</button>
  </div>

  <!-- Feed -->
  <div class="post-feed">
    <div class="post-card" *ngFor="let post of filteredPosts">
      <div class="post-header">
        <div>
          <strong>{{ post.author }}</strong>
          <span class="timestamp">{{ post.createdAt | date:'short' }}</span>
        </div>
        <button (click)="deletePost(post.id)" class="delete-button">ğŸ—‘ï¸</button>
      </div>

      <!-- Poszt szÃ¶veg -->
      <div *ngIf="!post.editing; else editPostBlock" class="post-content">{{ post.content }}</div>
      <ng-template #editPostBlock>
        <textarea [(ngModel)]="post.content"></textarea>
        <button (click)="toggleEditPost(post)">âœ… MentÃ©s</button>
      </ng-template>
      <button (click)="toggleEditPost(post)">âœï¸ SzerkesztÃ©s</button>

      <!-- KÃ©p -->
      <img *ngIf="post.image" [src]="post.image" alt="FeltÃ¶ltÃ¶tt kÃ©p" style="max-width: 100%; margin-top: 1rem;">
      <button (click)="likePost(post.id)" class="like-button">ğŸ‘ {{ post.likes || 0 }}</button>

      <!-- Kommentek -->
      <div class="comment-section">
        <textarea #commentInput placeholder="Ãrj egy kommentet..."></textarea>
        <button (click)="addComment(post.id, commentInput.value); commentInput.value=''">KÃ¼ldÃ©s</button>

        <div class="comment" *ngFor="let comment of post.comments">
          <div class="comment-content">

            <!-- Komment szÃ¶veg -->
            <div *ngIf="!comment.editing; else editCommentBlock">
              <strong>{{ comment.author }}</strong>: {{ comment.content }}
            </div>
            <ng-template #editCommentBlock>
              <textarea [(ngModel)]="comment.content"></textarea>
              <button (click)="toggleEditComment(comment)">âœ… MentÃ©s</button>
            </ng-template>

            <!-- Komment mÅ±veletek -->
            <div class="comment-meta">
              <button (click)="likeComment(post.id, comment.id)" class="like-button">ğŸ‘ {{ comment.likes || 0 }}</button>
              <button (click)="deleteComment(post.id, comment.id)" class="delete-button">ğŸ—‘ï¸</button>
              <button (click)="toggleEditComment(comment)">âœï¸</button>
              <button (click)="toggleReplyInput(comment.id)" class="reply-button">ğŸ’¬ VÃ¡lasz</button>
            </div>

            <!-- VÃ¡lasz Ã­rÃ¡sa -->
            <div *ngIf="replyInputVisible[comment.id]" class="reply-input">
              <textarea #replyText placeholder="Ãrj vÃ¡laszt..."></textarea>
              <button (click)="addReply(post.id, comment.id, replyText.value); replyText.value=''">KÃ¼ldÃ©s</button>
            </div>

            <!-- VÃ¡laszok -->
            <div class="reply" *ngFor="let reply of comment.replies">
              <strong>{{ reply.author }}</strong>: {{ reply.content }}
              <button (click)="likeComment(post.id, reply.id)" class="like-button">ğŸ‘ {{ reply.likes || 0 }}</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
